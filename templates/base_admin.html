<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}Admin Panel{% endblock %} | InventoryOS</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
  <link href="/static/css/admin.css" rel="stylesheet" />
</head>

<body class="admin-body">

  {% if request.path != '/admin/login' %}
  <!-- Sidebar -->
  <div class="sidebar d-flex flex-column">
    <div class="sidebar-brand">
      <div class="brand-icon"><i class="bi bi-box-seam-fill"></i></div>
      <span>InventoryOS</span>
    </div>
    <nav class="sidebar-nav flex-grow-1">
      <a href="/admin/dashboard" class="nav-link {% if request.path=='/admin/dashboard' %}active{% endif %}">
        <i class="bi bi-grid-1x2-fill"></i><span>Dashboard</span>
      </a>
      <a href="/admin/users" class="nav-link {% if request.path=='/admin/users' %}active{% endif %}">
        <i class="bi bi-people-fill"></i><span>Users</span>
      </a>
      <a href="/admin/products" class="nav-link {% if request.path=='/admin/products' %}active{% endif %}">
        <i class="bi bi-box-fill"></i><span>Products</span>
      </a>
      <a href="/admin/orders" class="nav-link {% if request.path=='/admin/orders' %}active{% endif %}">
        <i class="bi bi-cart-check-fill"></i><span>Orders</span>
      </a>
      <a href="/admin/inventory" class="nav-link {% if request.path=='/admin/inventory' %}active{% endif %}">
        <i class="bi bi-archive-fill"></i><span>Inventory</span>
      </a>
      <a href="/admin/logs" class="nav-link {% if request.path=='/admin/logs' %}active{% endif %}">
        <i class="bi bi-activity"></i><span>Activity Logs</span>
      </a>
    </nav>
    <div class="sidebar-footer">
      <button class="btn-logout" onclick="adminLogout()">
        <i class="bi bi-box-arrow-left"></i><span>Logout</span>
      </button>
    </div>
  </div>

  <!-- Main content -->
  <div class="admin-main">
    <div class="topbar d-flex align-items-center justify-content-between px-4 py-3">
      <h5 class="mb-0 fw-semibold">{% block page_title %}Dashboard{% endblock %}</h5>
      <div class="d-flex align-items-center gap-3">
        <span class="badge bg-success-subtle text-success px-3 py-2 rounded-pill">
          <i class="bi bi-circle-fill fs-xs me-1"></i> Live
        </span>
        <div class="avatar-pill" id="adminNameBadge">Admin</div>
      </div>
    </div>
    <div class="page-content px-4 pb-4">
      {% endif %}

      {% block content %}{% endblock %}

      {% if request.path != '/admin/login' %}
    </div>
  </div>
  {% endif %}

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Restore admin name from localStorage
    const adminName = localStorage.getItem('adminName');
    const el = document.getElementById('adminNameBadge');
    if (el && adminName) el.textContent = adminName;

    function adminLogout() {
      localStorage.removeItem('adminToken');
      localStorage.removeItem('adminName');
      localStorage.removeItem('adminRole');
      window.location.href = '/admin/login';
    }

    // Guard: redirect to login if no token
    if (window.location.pathname.startsWith('/admin/') &&
      window.location.pathname !== '/admin/login') {
      if (!localStorage.getItem('adminToken')) {
        window.location.href = '/admin/login';
      }
    }
  </script>
  {% block scripts %}{% endblock %}
</body>

</html>